<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayer Tracker</title>
    <link href="favicon.ico" rel="icon" type="image/x-icon">
    <link href="normalize.css" rel="stylesheet" type="text/css" media="all">
    <link href="style.css" rel="stylesheet" type="text/css" media="all">

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js"></script>
</head>

<body data-bind="class: darkMode">

    <div class="wrapper">
        <div class="bar">
            <button data-bind="click: showCalcFunc" class="calc-button" title="Show Calculate Number of Days Section">
                <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px"
                    viewBox="0 0 24 24" width="24px" fill="#000000">
                    <g>
                        <rect fill="none" height="24" width="24" />
                    </g>
                    <g>
                        <g>
                            <path
                                d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M19,19H5V5h14V19z" />
                            <rect height="1.5" width="5" x="6.25" y="7.72" />
                            <rect height="1.5" width="5" x="13" y="15.75" />
                            <rect height="1.5" width="5" x="13" y="13.25" />
                            <polygon
                                points="8,18 9.5,18 9.5,16 11.5,16 11.5,14.5 9.5,14.5 9.5,12.5 8,12.5 8,14.5 6,14.5 6,16 8,16" />
                            <polygon
                                points="14.09,10.95 15.5,9.54 16.91,10.95 17.97,9.89 16.56,8.47 17.97,7.06 16.91,6 15.5,7.41 14.09,6 13.03,7.06 14.44,8.47 13.03,9.89" />
                        </g>
                    </g>
                </svg>
            </button>
            <span class="bar-title">Missing Prayer Tracker</span>
            <button data-bind="click: darkModeFunc" class="dark-mode-button" title="Dark Mode">
                <span data-bind="if: darkModeBool" class="dark-mode-button-text">
                    <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px"
                        viewBox="0 0 24 24" width="24px" fill="#000000">
                        <rect fill="none" height="24" width="24" />
                        <path
                            d="M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0 c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2 c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1 C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06 c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41 l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41 c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36 c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z" />
                    </svg>
                </span>
                <span data-bind="ifnot: darkModeBool" class="dark-mode-button-text">
                    <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px"
                        viewBox="0 0 24 24" width="24px" fill="#000000">
                        <rect fill="none" height="24" width="24" />
                        <path
                            d="M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36c-0.98,1.37-2.58,2.26-4.4,2.26 c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z" />
                    </svg>
                </span>
            </button>
        </div>

        <div data-bind="if: showCalc">
            <div class="calc-modal">
                <div class="calc-modal-content">
                    <button class="calc-close" data-bind="click: showCalcFunc">&times;</button>
                    <p class="calc-title">Calculate Number of Days: (This calculation includes both days in the calculation)</p>

                    <b>Start Date:</b>
                    <label for="startMonth">
                        <b>Month:</b>
                        <select id="startMonth" data-bind="options: months, value: startMonth"></select>
                    </label>
                    <label for="startDay">
                        <b>Day:</b>
                        <select id="startDay" data-bind="options: startDaysOA, value: startDay"></select>
                    </label>
                    <label for="startYear">
                        <b>Year:</b>
                        <select id="startYear" data-bind="options: years, value: startYear"></select>
                    </label>
                    <p data-bind="text: startDate"></p>

                    <b>End Date:</b>
                    <label for="endMonth">
                        <b>Month:</b>
                        <select id="endMonth" data-bind="options: months, value: endMonth"></select>
                    </label>
                    <label for="endDay">
                        <b>Day:</b>
                        <select id="endDay" data-bind="options: endDaysOA, value: endDay"></select>
                    </label>
                    <label for="endYear">
                        <b>Year:</b>
                        <select id="endYear" data-bind="options: years, value: endYear"></select>
                    </label>
                    <div class="error" data-bind="if: endDateIssue">End Date is LESS THAN Start Date!</div>
                    <p data-bind="text: endDate"></p>

                    <input type="number" data-bind="textInput: calcNumOfDaysComp"></input>
                    <p>PARSED VALUE: <span data-bind="text: calcNumOfDays"></span></p>

                    <button data-bind="click: setGoal" class="" title="Set Goal">Set Goal</button>
                </div>
            </div>
        </div>

        <b>GOAL:</b>
        <p data-bind="text: goal"></p>

        <h3>Missed Prayers:</h3>

        <p data-bind="text: currentPrayer"></p>
        <p data-bind="text: daysPrayed"></p>
        <p data-bind="if: reachedGoal">REACHED GOAL!!!</p>

        <button data-bind="click: decrementPrayer">-</button>
        <button data-bind="click: incrementPrayer">+</button>

        <input type="number" data-bind="textInput: numToIncrementComp"></input>
        <button data-bind="click: decrementDay">- DAY</button>
        <button data-bind="click: incrementDay">+ DAY</button>

    </div>

    <script>

        if (localStorage.getItem('init') != 'set') {
            localStorage.setItem('init', 'set')
            localStorage.setItem('darkModeBool', false)
            localStorage.setItem('goal', 1)
            localStorage.setItem('days prayed', 0)
            localStorage.setItem('current prayer', 0)
            localStorage.setItem('num days to increment', 1)
        }

        let vm = new function () {
            let self = this

            self.darkModeBool = ko.observable(
                localStorage.getItem('darkModeBool') == 'true' ? true : false
            )
            self.darkMode = ko.computed(() => {
                localStorage.setItem('darkModeBool', self.darkModeBool())
                return self.darkModeBool() ? 'dark-mode' : 'light-mode'
            })
            self.darkModeFunc = () => {
                self.darkModeBool(self.darkModeBool() ? false : true)
            }

            self.showCalc = ko.observable(false)
            self.showCalcFunc = () => {
                self.showCalc(self.showCalc() ? false : true)
            }

            self.months = [
                "01 - January",
                "02 - February",
                "03 - March",
                "04 - April",
                "05 - May",
                "06 - June",
                "07 - July",
                "08 - August",
                "09 - September",
                "10 - October",
                "11 - November",
                "12 - December"
            ]

            self.days = [
                "01", "02", "03", "04", "05", "06", "07", "08", "09", "10",
                "11", "12", "13", "14", "15", "16", "17", "18", "19", "20",
                "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31"
            ]

            self.years = [
                '1900', '1901', '1902', '1903', '1904', '1905', '1906', '1907', '1908', '1909', '1910',
                '1911', '1912', '1913', '1914', '1915', '1916', '1917', '1918', '1919', '1920',
                '1921', '1922', '1923', '1924', '1925', '1926', '1927', '1928', '1929', '1930',
                '1931', '1932', '1933', '1934', '1935', '1936', '1937', '1938', '1939', '1940',
                '1941', '1942', '1943', '1944', '1945', '1946', '1947', '1948', '1949', '1950',
                '1951', '1952', '1953', '1954', '1955', '1956', '1957', '1958', '1959', '1960',
                '1961', '1962', '1963', '1964', '1965', '1966', '1967', '1968', '1969', '1970',
                '1971', '1972', '1973', '1974', '1975', '1976', '1977', '1978', '1979', '1980',
                '1981', '1982', '1983', '1984', '1985', '1986', '1987', '1988', '1989', '1990',
                '1991', '1992', '1993', '1994', '1995', '1996', '1997', '1998', '1999', '2000',
                '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010',
                '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020',
                '2021', '2022', '2023', '2024', '2025', '2026', '2027', '2028', '2029', '2030'
            ]

            self.prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha']

            let today = new Date()

            let leapYear = (year) => {
                return (year % 100 == 0) ? (year % 400 == 0) : (year % 4 == 0)
            }

            self.startMonth = ko.observable(self.months[0])
            self.startYear = ko.observable(self.years[100])
            self.startDay = ko.observable(self.days[0])

            self.startDaysOA = ko.observableArray(self.days.slice())
            self.startDayComp = ko.computed(() => {
                let month = self.startMonth()
                let year = parseInt(self.startYear())
                if (month == "02 - February" && leapYear(year)) {
                    self.startDaysOA(self.days.slice(0, 29))
                } else if (month == "02 - February") {
                    self.startDaysOA(self.days.slice(0, 28))
                } else if (month == "04 - April"
                    || month == "06 - June"
                    || month == "09 - September"
                    || month == "11 - November"
                ) {
                    self.startDaysOA(self.days.slice(0, 30))
                } else {
                    self.startDaysOA(self.days.slice())
                }
            })

            self.endMonth = ko.observable(self.months[today.getMonth()])
            self.endDay = ko.observable(self.days[today.getDate() - 1])
            self.endYear = ko.observable(
                today.getFullYear().toString()
            )

            self.endDaysOA = ko.observableArray(self.days.slice())
            self.endDayComp = ko.computed(() => {
                let month = self.endMonth()
                let year = parseInt(self.endYear())
                if (month == "02 - February" && leapYear(year)) {
                    self.endDaysOA(self.days.slice(0, 29))
                } else if (month == "02 - February") {
                    self.endDaysOA(self.days.slice(0, 28))
                } else if (month == "04 - April"
                    || month == "06 - June"
                    || month == "09 - September"
                    || month == "11 - November"
                ) {
                    self.endDaysOA(self.days.slice(0, 30))
                } else {
                    self.endDaysOA(self.days.slice())
                }
            })

            self.startDate = ko.pureComputed(() => {
                //Set value to the beginning of the day
                return new Date(self.startMonth().slice(0, 2) + '/' + self.startDay() + '/' + self.startYear())
            })

            self.endDateIssue = ko.observable(false)
            self.endDate = ko.computed(() => {
                //Set value to the end of the day
                let date = new Date(self.endMonth().slice(0, 2) + '/' + self.endDay() + '/' + self.endYear() + ' 23:59:59')
                if (date.getTime() < self.startDate().getTime()) { self.endDateIssue(true) }
                else { self.endDateIssue(false) }
                return date
            })

            let oneDay = 1000 * 60 * 60 * 24

            self.calcNumOfDays = ko.observable()
            self.calcNumOfDaysComp = ko.computed({
                read: () => {
                    let calc = (self.endDate().getTime() - self.startDate().getTime()) / oneDay
                    let ceilVal = Math.ceil(parseFloat(calc))
                    self.calcNumOfDays(ceilVal)
                    return calc
                },
                write: (value) => {
                    let ceilVal = Math.ceil(parseFloat(value))
                    if (isNaN(ceilVal)) { self.calcNumOfDays(0) }
                    else { self.calcNumOfDays(ceilVal) }
                }
            })

            self.goal = ko.observable(parseInt(localStorage.getItem('goal')))
            self.setGoal = () => {
                localStorage.setItem('goal', self.calcNumOfDays())
                self.goal(self.calcNumOfDays())
                self.showCalc(false)
            }

            self.prayer = ko.observable(parseInt(localStorage.getItem('current prayer')))

            self.currentPrayer = ko.pureComputed(() => {
                return self.prayers[self.prayer()]
            })

            self.daysPrayed = ko.observable(parseInt(localStorage.getItem('days prayed')))

            self.reachedGoal = ko.pureComputed(() => {
                return self.daysPrayed() >= self.goal()
            })

            self.incrementPrayer = () => {
                let prayerNum = self.prayer() + 1
                if (prayerNum == 5) {
                    prayerNum = 0
                    self.daysPrayed(self.daysPrayed() + 1)
                    localStorage.setItem('days prayed', self.daysPrayed())
                }

                self.prayer(prayerNum)
                localStorage.setItem('current prayer', prayerNum)
            }

            self.decrementPrayer = () => {
                let prayerNum = self.prayer() - 1
                if (prayerNum == -1) {
                    prayerNum = 4
                    self.daysPrayed(self.daysPrayed() - 1)
                    localStorage.setItem('days prayed', self.daysPrayed())
                }

                self.prayer(prayerNum)
                localStorage.setItem('current prayer', self.prayer())
            }

            self.numToIncrement = ko.observable(parseInt(localStorage.getItem('num days to increment')))
            self.numToIncrementComp = ko.pureComputed({
                read: self.numToIncrement,
                write: (value) => {
                    let num = parseInt(value)
                    if (isNaN(num)) {
                        self.numToIncrement(1)
                        localStorage.setItem('num days to increment', 1)
                    }
                    else {
                        self.numToIncrement(num)
                        localStorage.setItem('num days to increment', num)
                    }
                }
            })
            self.incrementDay = () => {
                self.daysPrayed(self.daysPrayed() + self.numToIncrement())
                localStorage.setItem('days prayed', self.daysPrayed())

                self.prayer(0)
                localStorage.setItem('current prayer', self.prayer())
            }

            self.decrementDay = () => {
                self.daysPrayed(self.daysPrayed() - self.numToIncrement())
                localStorage.setItem('days prayed', self.daysPrayed())

                self.prayer(0)
                localStorage.setItem('current prayer', self.prayer())
            }

        }

        ko.applyBindings(vm)

    </script>

</body>

</html>